This is the upgraded version from the feature-edit branch.
